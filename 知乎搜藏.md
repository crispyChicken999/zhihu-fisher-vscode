知乎搜藏

1. 关于知乎收藏

   - 目前知乎收藏的内容是通过知乎的 API 获取的。
   - 收藏的内容包括文章、问题、答案等。
   - 目前希望的是：实现是通过 API 获取收藏列表，然后根据收藏的类型分别处理。

2. 我希望的是通过调用API，来拿到用户的搜藏夹，然后再来展示收藏夹里面的内容。

3. 搜藏夹允许我向你介绍
   1. 获取收藏夹，首先需要拿到用户的主页，然后才能拿到用户的收藏夹。
   2. 主页通过https://www.zhihu.com/api/v4/me?include=is_realname（GET）请求，需要携带cookie，没的话就报错
   3. 响应如下：
   4. {"id":"92f16f3e8f9a3a172d3efae08899ee7e","url_token":"chen-xiao-jun-3-8","name":"脆皮鸡你太美","use_default_avatar":false,"avatar_url":"https://pic1.zhimg.com/v2-46cd18e0b9888947682549e69aa62987_xl.jpg?source=32738c0c\u0026needBackground=1","avatar_url_template":"https://pic1.zhimg.com/v2-46cd18e0b9888947682549e69aa62987_l.jpg?source=32738c0c\u0026needBackground=1","is_org":false,"type":"people","url":"https://www.zhihu.com/api/v4/people/chen-xiao-jun-3-8","user_type":"people","headline":"","headline_render":"","gender":1,"is_advertiser":false,"ip_info":"IP 属地广东","vip_info":{"is_vip":false,"vip_type":0,"rename_days":"0","entrance_v2":null,"rename_frequency":0,"rename_await_days":0},"kvip_info":{"is_vip":false},"answer_count":5,"question_count":0,"articles_count":0,"columns_count":0,"zvideo_count":0,"favorite_count":3,"pins_count":0,"voteup_count":2,"thanked_count":1,"available_medals_count":0,"org_verify_status":null,"uid":"646443533465292800","default_notifications_count":0,"follow_notifications_count":0,"vote_thank_notifications_count":0,"messages_count":9,"creation_count":5,"is_realname":true,"has_applying_column":false,"has_add_baike_summary_permission":false,"editor_info":["bio"]}
   5. 拿到url也就是当前登录的用户的主页，那么我们可以拼接 https://www.zhihu.com/people/[用户的专属ID，从URL里面可以获取，或者你看看url_token？]/collections，这里面可以获取到用户创建的收藏夹.
   6. 如果需要获取“我关注的收藏夹”的话，需要从https://www.zhihu.com/people/[用户的专属ID]/collections/following，这里面拿。
4. 上面这个是一种方式不过好像不太好？因为还要爬页面，但是我们好像可以通过API来获取。
5. https://www.zhihu.com/api/v4/people/[url_token]/collections?include=data%5B*%5D.updated_time%2Canswer_count%2Cfollower_count%2Ccreator%2Cdescription%2Cis_following%2Ccomment_count%2Ccreated_time%3Bdata%5B*%5D.creator.kvip_info%3Bdata%5B*%5D.creator.vip_info&offset=0&limit=20 这是获取用户的创建的收藏夹列表的接口GET.
6. 不行！这个获取收藏夹的接口做了反爬吊毛！！！不要用这个方式
7. 所以还是走回老本行，通过爬虫的方式来拿，也就是Puppeteer。第一种方式。

8. 拿到了以后我们就先构建侧边栏的收藏的结构。他是一个树状结构，分别是搜藏（我创建的搜藏，我关注的收藏），然后收藏分类里面放的就是对应的收藏列表。然后我们可以去解析收藏的DOM去获取。
   1. 我创建的收藏item DOM如下：
      1. <div class="SelfCollectionItem-innerContainer"><a class="SelfCollectionItem-title" href="/collection/873365394" rel="noreferrer noopener">我的收藏 删除</button></div></div>
   2. 我关注的收藏item DOM：
      1. <div class="FollowingCollectionItem-innerContainer"><div class="AuthorInfo AuthorInfo--plain" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="AuthorInfo"><meta itemprop="name" content="不忘初心"><meta itemprop="image" content="https://pic1.zhimg.com/0b375ec38ad95abe5197959b0c9222e1_l.jpg?source=b1748391"><meta itemprop="url" content="https://www.zhihu.com/people/bu-wang-chu-xin-62"><meta itemprop="zhihu:followerCount"><span class="UserLink AuthorInfo-avatarWrapper"><div class="css-1gomreu"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="//www.zhihu.com/people/bu-wang-chu-xin-62"><img class="Avatar AuthorInfo-avatar css-alvukd" src="https://pic1.zhimg.com/0b375ec38ad95abe5197959b0c9222e1_l.jpg?source=b1748391" srcset="https://pic1.zhimg.com/0b375ec38ad95abe5197959b0c9222e1_l.jpg?source=b1748391 2x" alt="不忘初心"></a></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="css-1gomreu"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="//www.zhihu.com/people/bu-wang-chu-xin-62">不忘初心</a></div></span></div><div class="AuthorInfo-detail"><div></div></div></div></div></div><a class="FollowingCollectionItem-title" rel="noreferrer noopener" href="/collection/76620405">那些热衷的黑暗面</a><div class="FollowingCollectionItem-hint">创建于2015-10-27 · 1 人关注 · 4 条内容 </div><div class="FollowingCollectionItem-actions"><button type="button" class="Button FollowButton FEfUrdfMIKpQDJDqkjte Button--primary Button--grey epMJl0lFQuYbC7jrwr_o ZdfrHW7Ef5ZjwFiiBJuS">已关注</button><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain Button--withIcon Button--withLabel fEPKGkUK5jyc4fUuT0QP B46v1Ak6Gj5sL2JTS4PY RuuQ6TOh2cRzJr6WlyQp"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="Zi Zi--Comment Button-zi t2ntD6J1DemdOdvh5FB4" fill="currentColor"><path fill-rule="evenodd" d="M12 2.75a9.25 9.25 0 1 0 4.737 17.197l2.643.817a1 1 0 0 0 1.25-1.25l-.8-2.588A9.25 9.25 0 0 0 12 2.75Z" clip-rule="evenodd"></path></svg></span>添加评论</button><button type="button" class="Button FEfUrdfMIKpQDJDqkjte Button--plain fEPKGkUK5jyc4fUuT0QP"><span style="display: inline-flex; align-items: center;">​<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" class="ZDI ZDI--FlagFill24" fill="currentColor"><path d="M12.842 4.421c-1.86-1.24-3.957-1.408-5.798-1.025-1.827.38-3.467 1.313-4.47 2.381a.75.75 0 0 0-.171.732l4.44 14.546a.75.75 0 1 0 1.434-.438l-1.08-3.542c.025-.018.053-.036.083-.054.298-.184.801-.415 1.568-.523 1.386-.197 2.307.129 3.341.543l.187.075c1.005.405 2.161.872 3.791.804 1.401-.003 2.707-.45 3.67-1.015.483-.284.903-.612 1.212-.953.284-.312.581-.752.581-1.255V5.046a.75.75 0 0 0-1.17-.622c-1.82 1.23-4.881 1.823-7.618-.003Z"></path></svg></span> 举报</button></div></div>
   3. 拿到href以后就是我们要的收藏夹的URL啦。
   4. 需要用户点击具体的收藏夹的时候我们再去加载其内容，然后这个可以通过接口来获取： https://www.zhihu.com/api/v4/collections/80092529/items?offset=&limit=20 
   5. 对应的响应是：
      1. {"paging":{"is_end":true,"is_start":false,"next":"https://www.zhihu.com/api/v4/collections/80092529/items?limit=20\u0026offset=40","previous":"https://www.zhihu.com/api/v4/collections/80092529/items?limit=20\u0026offset=0","totals":21},"data":[{"content":{"type":"answer","answer_type":"NORMAL","url":"https://www.zhihu.com/question/37885340/answer/74096827","created_time":1448547140,"updated_time":1451175092,"author":{"id":"b1402078c71c6b0f03acb3d68c3ebe47","url_token":"bu-wang-chu-xin-62","name":"不忘初心","use_default_avatar":false,"avatar_url":"https://picx.zhimg.com/0b375ec38ad95abe5197959b0c9222e1_l.jpg?source=0df5f383","avatar_url_template":"https://picx.zhimg.com/0b375ec38ad95abe5197959b0c9222e1.jpg?source=0df5f383","is_org":false,"type":"people","url":"https://www.zhihu.com/people/b1402078c71c6b0f03acb3d68c3ebe47","user_type":"people","headline":"我将自己最美好最诚挚的感情都给了你。","gender":1,"is_advertiser":false,"vip_info":{"is_vip":false,"rename_days":"","widget":{"url":"","night_mode_url":""},"vip_icon":{"url":"","night_mode_url":""}},"badge_v2":{"title":"","merged_badges":[],"detail_badges":[],"icon":"","night_icon":""},"actived_at":1},"thumbnail":"https://picx.zhimg.com/78366f28040ead561106af56a966e2d9.jpg?source=7e7ef6e2\u0026needBackground=1","is_collapsed":false,"is_copyable":true,"is_visible":true,"is_normal":true,"voteup_count":1139,"comment_count":178,"thanks_count":444,"is_mine":false,"comment_permission":"all","reshipment_settings":"allowed","content":"xxx",//【具体的内容，因为太多了我就删掉了暂时先忽略】"excerpt":"已授权给橙光游戏。 现在说十佳有点早了，还没到年底呢，我离我今年订的300部目标也还差35部。我也有点选择恐惧症，在这里也不做十佳总结了吧，就来推荐推荐我今年看过的佳片吧。每天不定期更新~ 桃姐说十佳渐渐的就变成了唠家常或者回顾一年。电影的魅力在于你能在影片中找到自己的影子，每个年龄都会有不同的偏好，每个人也都会有不同的口味，所以个人十佳只需要能带给你难以忘怀的感触的片子。而电影的好坏大可交给理性的影评…","suggest_edit":{"reason":"回答被建议修改：\n\n（已修改，评估中）","status":true,"tip":"作者修改内容通过后，回答会重新显示恢复正常","title":"","unnormal_details":{"status":"","description":"","reason":"","reason_id":0,"note":""},"url":""},"thumbnail_info":{"count":55,"type":"","thumbnails":[{"type_":0,"url":"https://picx.zhimg.com/78366f28040ead561106af56a966e2d9.jpg?source=7e7ef6e2\u0026needBackground=1","width":424,"height":600,"token":"78366f28040ead561106af56a966e2d9","data_id":0,"type":"image"},{"type_":0,"url":"https://picx.zhimg.com/cfb8bfd8013501e6f3cbe69340bcba8d.jpg?source=7e7ef6e2\u0026needBackground=1","width":420,"height":600,"token":"cfb8bfd8013501e6f3cbe69340bcba8d","data_id":0,"type":"image"},{"type_":0,"url":"https://picx.zhimg.com/6b60edf606dbfe0c248dad71084f7676.jpg?source=7e7ef6e2\u0026needBackground=1","width":405,"height":600,"token":"6b60edf606dbfe0c248dad71084f7676","data_id":0,"type":"image"}]},"attached_info":"ogEOCAQQAxi7waojIM6mwQOSAiIKCDI1MDYyMDAzEgg3NDA5NjgyNxgEIgpJTUFHRV9URVhU","relationship":{"is_author":false,"is_authorized":false,"is_nothelp":false,"is_thanked":false,"voting":1},"attachment":{"type":"ANSWER","attachment_id":""},"is_deleted":false,"question":{"type":"question","title":"2015 年你心目中的十大佳片有哪些？","question_type":"normal","created":1448461746,"updated_time":1479023802,"url":"https://www.zhihu.com/question/37885340","is_deleted":false,"id":"37885340"},"id":"74096827"},"created":"2015-11-26T22:12:20+08:00"}]}
   6. 我希望的是每一个收藏夹都是一个folder，点开的来的时候去看看里面是否加载完了，比如一个搜藏夹里面有25条，那么我们offset为20的时候，拿到的item数量为20也就是limit的值那么可以认为还没加载完，那么我们可以通过设置offset去加载下一页，直到加载的数量小于limit 的值，就认为加载完成了。这里的加载方式我希望的是，通过在folder添加一个虚拟的item然后点击后我们去请求下一页对应的接口，加载完成后再push到已加载的收藏夹内容的数组中，如果点击后没东西了，那么就显示“-没有更多了-”。
9. 这边再跟你说明一下结构：

- 收藏（侧边栏的入口）
  - 我创建的收藏夹（类型1）
    - 收藏夹1
    - 收藏夹2
    - 收藏夹3
    - ...
    - 收藏夹20
    - 加载更多收藏夹（https://www.zhihu.com/people/chen-xiao-jun-3-8/collections?page=2，类似这样去爬去新的数据，前提是已经有20个收藏夹了）
  - 我关注的收藏（类型2，和1类似）
    - 收藏夹1（这边举个例子，里面的收藏item，下面单独说明）
      - 收藏item1
      - 收藏item2
      - ...
      - 收藏item20
      - 加载更多收藏（通过接口获取下一页的）
    - 收藏夹2
    - ...
    - 收藏夹20
    - 加载更多收藏夹

> 收藏item有三种类型：文章（https://zhuanlan.zhihu.com/p/214058841），单独的回答（https://www.zhihu.com/question/423780782/answer/1914028968518062960），问题（https://www.zhihu.com/question/423780782）。
> 也很好处理，文章和问题已经有了就按照之前的方式来进行展示就可以了。然后单独的回答，其实可以认为是一个问题里面只有一个回答的方式进行解析可以转换一下数据结构就可以了。

==== 上述功能已实现 =====

这边跟你说明一下仍然存在的问题：
1. 首先，我希望“我创建的收藏夹”和“我关注的收藏夹”的action也能够有刷新的按钮，去更新他的收藏夹情况。
2. 然后我不知道你是否做了处理，因为这两个大类下展示的是收藏夹的列表页，是分页来的，就是当前获取的收藏夹数量到达limit的时候，那么我们认为还有更多的收藏夹。
 - 加载更多收藏夹（https://www.zhihu.com/people/chen-xiao-jun-3-8/collections?page=2，类似这样去爬去新的数据，前提是已经有20个收藏夹了），如果做了这个处理就可以了。
3. 因为每个搜藏夹在获取的时候已经有总数了，如果我们没点开搜藏夹那么应该显示(0/total)，现在是(0/0)，体验就不好，等点击后拿到真实数据我们再去更新总数就可以了。
4. 然后呢有时候搜藏夹的总数和实际数量不一致，就是实际只有两条，但是总数却显示为4条，那么我们需要通过接口返回值去动态判断其真实情况，然后更新对应的数据。
5. 然后我看有时候加载更多，会加载了一些重复的item，这个可能跟接口设计有关系，但是呢我们需要主动去重，其实就是根据收藏时间来进行判断，因为我们不可能一个时间收藏了两个或多个的item，确保收藏时间的唯一性即可。
6. 搜藏item的类型为文章和问题，那么我们就按照之前的方式来打开，就是显示他的详情页。但是针对回答，因为content就是这个回答的内容，那么我们应该构建一个关于回答的单独的展示页面，就是说我们点击回答的时候，按照“问题”的解析方式，给answerList，push这个回答，让用户一点开来就可以看到这个回答，然后用户也可以加载其他的回答去查看，当然了我们最好做一层过滤，如果后续加载的回答中有这个回答了，那么我们应该去除这个回答

==== 上述功能已实现 =====

这边，那么已经创建了，收藏夹，那么我希望呢给推荐列表添加一个收藏按钮，点击后用户可以指定要添加到哪个收藏夹里面。

获取用户有什么收藏夹可以通过这个接口来：

如果是问题/问答，那么拼接一下问题的id就可以获取 https://www.zhihu.com/api/v4/collections/contents/answer/1925586459701781602?offset=0&limit=5 （GET）

返回：{"data":[{"id":80092529,"type":"collection","title":"默认","is_public":true,"url":"https://api.zhihu.com/collections/80092529","description":"好的东西不必多说","follower_count":0,"answer_count":23,"item_count":23,"like_count":0,"view_count":36,"comment_count":0,"is_following":false,"is_liking":false,"created_time":1448726678,"updated_time":1752032611,"creator":{"id":"92f16f3e8f9a3a172d3efae08899ee7e","type":"people","is_following":false,"avatar_url":"https://pica.zhimg.com/50/v2-46cd18e0b9888947682549e69aa62987_l.jpg?source=0df5f383","headline":"","user_type":"people","gender":1,"url":"https://api.zhihu.com/people/92f16f3e8f9a3a172d3efae08899ee7e","name":"脆皮鸡你太美","is_followed":false,"badge":[]},"is_favorited":false,"is_default":false},{"id":873365394,"type":"collection","title":"我的收藏","is_public":false,"url":"https://api.zhihu.com/collections/873365394","description":"","follower_count":0,"answer_count":2,"item_count":2,"like_count":0,"view_count":18,"comment_count":0,"is_following":false,"is_liking":false,"created_time":1682523986,"updated_time":1751943998,"creator":{"id":"92f16f3e8f9a3a172d3efae08899ee7e","type":"people","is_following":false,"avatar_url":"https://picx.zhimg.com/50/v2-46cd18e0b9888947682549e69aa62987_l.jpg?source=0df5f383","headline":"","user_type":"people","gender":1,"url":"https://api.zhihu.com/people/92f16f3e8f9a3a172d3efae08899ee7e","name":"脆皮鸡你太美","is_followed":false,"badge":[]},"is_favorited":false,"is_default":true},{"id":229772158,"type":"collection","title":"编程必备","is_public":true,"url":"https://api.zhihu.com/collections/229772158","description":"","follower_count":0,"answer_count":25,"item_count":25,"like_count":0,"view_count":17,"comment_count":0,"is_following":false,"is_liking":false,"created_time":1521892871,"updated_time":1596762291,"creator":{"id":"92f16f3e8f9a3a172d3efae08899ee7e","type":"people","is_following":false,"avatar_url":"https://picx.zhimg.com/50/v2-46cd18e0b9888947682549e69aa62987_l.jpg?source=0df5f383","headline":"","user_type":"people","gender":1,"url":"https://api.zhihu.com/people/92f16f3e8f9a3a172d3efae08899ee7e","name":"脆皮鸡你太美","is_followed":false,"badge":[]},"is_favorited":false,"is_default":false}],"favlists_count":106,"paging":{"is_end":true,"is_start":true,"next":"https://www.zhihu.com/api/v4/collections/contents/article/1926032353307891630?limit=5\u0026offset=5","previous":"https://www.zhihu.com/api/v4/collections/contents/article/1926032353307891630?limit=5\u0026offset=0","totals":3}}

点击收藏接口是：请求网址:
https://www.zhihu.com/api/v4/collections/80092529/contents?content_id=1925744658711046104&content_type=answer
请求方法:
POST
响应是：
{"success":true}
才能认为收藏成功

如果是文章：https://www.zhihu.com/api/v4/collections/contents/article/1926032353307891630?offset=0&limit=5 同理拼接文章的id即可

点击收藏：https://www.zhihu.com/api/v4/collections/80092529/contents?content_id=1926032353307891630&content_type=article，其他同理

取消收藏是：
请求网址:
https://www.zhihu.com/api/v4/collections/80092529/contents/1925744658711046104?content_type=answer
请求方法:
DELETE

如果是文章取消收藏则修改content_type即可

看看用什么形式来进行处理比较好，然后需要告诉用户搜藏夹不会主动更新，怕被检测到导致cookie提前过期。需要的话收藏了自己去刷新一下列表即可。

获取收藏夹的列表是可以滚动加载更多的，看看用什么形式来进行比较好，比如新开一个webview？